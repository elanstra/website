<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HIIT Architect 4.0</title>
    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            --bg-body: #0a0a0a;
            --bg-card: #161616;
            --bg-input: #222222;
            --text-main: #f0f0f0;
            --text-muted: #888888;
            --primary: #FF4D00;
            --primary-hover: #ff6a2a;
            --primary-glow: rgba(255, 77, 0, 0.3);
            --accent: #00D4FF;
            --accent-glow: rgba(0, 212, 255, 0.3);
            --warmup: #FFD700;
            --success: #00ff88;
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --font-main: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-mono: 'SF Mono', 'Fira Code', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Subtle grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255,77,0,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,77,0,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }

        /* --- LAYOUT --- */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: var(--spacing-md);
            padding-bottom: 6rem;
        }

        .header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg) 0;
        }

        .header__title {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, #fff 0%, #FF4D00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header__subtitle { 
            color: var(--text-muted); 
            font-size: 0.85rem; 
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* --- NAV TABS --- */
        .nav-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            background: var(--bg-card);
            padding: 6px;
            border-radius: var(--border-radius);
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s;
        }

        .nav-tab--active {
            background: var(--primary);
            color: white;
        }

        /* --- PANELS --- */
        .panel { display: none; }
        .panel--active { display: block; animation: fadeIn 0.3s ease; }

        /* --- FORM COMPONENTS --- */
        .config-panel {
            background-color: var(--bg-card);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border: 1px solid #222;
        }

        .form-group { margin-bottom: var(--spacing-lg); }
        .form-group__label { 
            display: block; 
            margin-bottom: var(--spacing-sm); 
            font-weight: 700;
            font-size: 0.95rem;
        }
        .form-group__sub { 
            display: block; 
            font-size: 0.75rem; 
            color: var(--text-muted); 
            margin-bottom: var(--spacing-sm); 
        }

        /* Quick Presets */
        .presets {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .preset-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px 8px;
            border: 2px solid #333;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preset-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .preset-btn span {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 2px;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: var(--spacing-sm);
        }

        .option-grid--gear {
            grid-template-columns: repeat(3, 1fr);
        }

        .option-input { display: none; }

        .option-label {
            background-color: var(--bg-input);
            padding: var(--spacing-md) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            gap: 4px;
        }

        .option-label:hover {
            border-color: #444;
        }

        .option-label .icon {
            font-size: 1.3rem;
            margin-bottom: 2px;
        }

        .option-input:checked + .option-label {
            border-color: var(--primary);
            background-color: rgba(255, 77, 0, 0.15);
            color: var(--primary);
            font-weight: 600;
        }

        /* Range Slider */
        .range-container { 
            display: flex; 
            align-items: center; 
            gap: var(--spacing-md);
            background: var(--bg-input);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
        }
        
        .range-input {
            flex-grow: 1; 
            -webkit-appearance: none; 
            height: 6px; 
            background: #333; 
            border-radius: 5px; 
            outline: none;
        }
        
        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none; 
            width: 22px; 
            height: 22px; 
            border-radius: 50%; 
            background: var(--primary); 
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .range-value { 
            font-weight: 800; 
            font-size: 1.3rem; 
            color: var(--primary); 
            min-width: 70px; 
            text-align: right;
            font-family: var(--font-mono);
        }

        /* Button */
        .btn {
            display: block; 
            width: 100%; 
            padding: 1rem; 
            border: none; 
            border-radius: var(--border-radius);
            font-size: 1rem; 
            font-weight: 700; 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 1.5px;
            transition: all 0.15s;
        }
        
        .btn:active { transform: scale(0.98); }
        
        .btn--primary { 
            background: linear-gradient(135deg, var(--primary) 0%, #ff6a2a 100%);
            color: white;
            box-shadow: 0 4px 20px var(--primary-glow);
        }
        
        .btn--primary:hover {
            box-shadow: 0 6px 30px var(--primary-glow);
        }
        
        .btn--secondary { 
            background-color: var(--bg-input); 
            color: var(--text-muted); 
            margin-top: var(--spacing-md);
        }

        /* --- REPORT SECTION --- */
        .stats-grid {
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: var(--spacing-sm); 
            margin-bottom: var(--spacing-lg);
        }
        
        .stat-card {
            background-color: var(--bg-card); 
            padding: var(--spacing-md); 
            border-radius: var(--border-radius-sm);
            text-align: center; 
            border-bottom: 3px solid var(--primary);
        }
        
        .stat-card__value { 
            display: block; 
            font-size: 1.4rem; 
            font-weight: 800;
            font-family: var(--font-mono);
        }
        
        .stat-card__label { 
            font-size: 0.7rem; 
            color: var(--text-muted); 
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .timeline { 
            margin-top: var(--spacing-lg); 
            max-height: 400px;
            overflow-y: auto;
            padding-right: var(--spacing-sm);
        }

        .timeline::-webkit-scrollbar {
            width: 4px;
        }

        .timeline::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        .timeline-item { 
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-card);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-sm);
            border-left: 4px solid #333;
        }
        
        .timeline-item--warmup { border-left-color: var(--warmup); }
        .timeline-item--high { border-left-color: var(--primary); }
        .timeline-item--rest { border-left-color: var(--accent); }
        
        .timeline-item__info { flex: 1; }
        .timeline-item__title { font-weight: 700; font-size: 0.95rem; }
        .timeline-item__desc { font-size: 0.75rem; color: var(--text-muted); }
        .timeline-item__time { 
            font-family: var(--font-mono);
            font-weight: 700;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* --- HISTORY SECTION --- */
        .history-empty {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-muted);
        }

        .history-empty__icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.3;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .history-item {
            background: var(--bg-card);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            border: 1px solid #222;
        }

        .history-item__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .history-item__date {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .history-item__badge {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .history-item__stats {
            display: flex;
            gap: var(--spacing-lg);
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .history-item__stat strong {
            color: var(--text-main);
        }

        .history-actions {
            margin-top: var(--spacing-lg);
        }

        /* --- PLAYER OVERLAY --- */
        .player-overlay {
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; 
            height: 100%;
            background-color: var(--bg-body); 
            z-index: 100;
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between;
            padding: 1.5rem; 
            text-align: center;
        }
        
        .player--active { display: flex; }

        .player--warmup { background: radial-gradient(ellipse at center top, #2a2200 0%, #0a0a0a 70%); }
        .player--work { background: radial-gradient(ellipse at center top, #3d1a0a 0%, #0a0a0a 70%); }
        .player--rest { background: radial-gradient(ellipse at center top, #0a2a3d 0%, #0a0a0a 70%); }

        .player-header { 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        
        .player-phase {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 800;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
        }

        .player-phase--work { background: var(--primary); color: white; }
        .player-phase--rest { background: var(--accent); color: black; }
        .player-phase--warmup { background: var(--warmup); color: black; }

        .player-progress { 
            font-size: 0.85rem; 
            color: var(--text-muted); 
            font-family: var(--font-mono);
        }
        
        .player-main {
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            width: 100%;
        }

        .timer-big { 
            font-size: 8rem; 
            font-weight: 800; 
            line-height: 1; 
            margin: 0.5rem 0; 
            font-variant-numeric: tabular-nums;
            font-family: var(--font-mono);
            text-shadow: 0 0 60px var(--primary-glow);
        }
        
        .current-move { 
            font-size: 2rem; 
            font-weight: 700; 
            margin-bottom: 0.5rem; 
            line-height: 1.2;
        }
        
        .current-tip { 
            font-size: 0.9rem; 
            color: var(--text-muted); 
            max-width: 350px; 
            margin: 0 auto;
            font-style: italic;
            opacity: 0.8;
        }

        /* Time Adjust Buttons */
        .time-adjust {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .time-adjust-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-mono);
        }

        .time-adjust-btn:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .up-next {
            background: rgba(255,255,255,0.05); 
            padding: 1rem; 
            border-radius: var(--border-radius-sm); 
            width: 100%; 
            max-width: 350px;
            margin-bottom: var(--spacing-md);
        }
        
        .up-next__label { 
            display: block; 
            font-size: 0.65rem; 
            text-transform: uppercase; 
            color: var(--text-muted); 
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .up-next__name { 
            font-weight: 700; 
            font-size: 1.1rem; 
            color: var(--accent); 
        }

        .player-controls { 
            width: 100%; 
            max-width: 400px; 
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--spacing-sm); 
        }
        
        .btn-control { 
            padding: 1rem; 
            font-size: 0.85rem;
            border-radius: var(--border-radius-sm);
        }
        
        .btn-skip { 
            background: #333; 
            color: #fff; 
        }

        .btn-pause {
            background: var(--primary);
            color: white;
        }

        .btn-pause--paused {
            background: var(--success);
            color: black;
        }
        
        .btn-stop { 
            background: #222; 
            color: #888;
            border: 1px solid #333;
        }

        /* --- CONFETTI CANVAS --- */
        #confettiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 200;
        }

        /* --- COMPLETION SCREEN --- */
        .completion-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-body);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: var(--spacing-xl);
        }

        .completion-overlay--active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .completion__icon {
            font-size: 5rem;
            margin-bottom: var(--spacing-md);
            animation: bounce 0.6s ease infinite alternate;
        }

        .completion__title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .completion__subtitle {
            color: var(--text-muted);
            margin-bottom: var(--spacing-xl);
        }

        .completion__stats {
            display: flex;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .completion__stat {
            text-align: center;
        }

        .completion__stat-value {
            display: block;
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            font-family: var(--font-mono);
        }

        .completion__stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .hidden { display: none; }

    </style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- MAIN APP -->
<div class="container" id="mainApp">
    <header class="header">
        <h1 class="header__title">HIIT ARCHITECT</h1>
        <p class="header__subtitle">Bouw ‚Ä¢ Start ‚Ä¢ Zweet</p>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="nav-tab nav-tab--active" data-tab="build">Bouwen</button>
        <button class="nav-tab" data-tab="history">Geschiedenis</button>
    </nav>

    <!-- BUILD PANEL -->
    <div id="buildPanel" class="panel panel--active">
        
        <!-- Config Section -->
        <div id="configSection" class="config-panel">
            
            <!-- Quick Presets -->
            <div class="form-group">
                <label class="form-group__label">Snelle Presets</label>
                <div class="presets">
                    <button class="preset-btn" data-preset="quick">
                        <span>‚ö°</span> Quick<br>10 min
                    </button>
                    <button class="preset-btn" data-preset="tabata">
                        <span>üî•</span> Tabata<br>4 min
                    </button>
                    <button class="preset-btn" data-preset="standard">
                        <span>üí™</span> Standaard<br>20 min
                    </button>
                    <button class="preset-btn" data-preset="endurance">
                        <span>üèÉ</span> Endurance<br>30 min
                    </button>
                </div>
            </div>

            <!-- Time -->
            <div class="form-group">
                <label class="form-group__label">Beschikbare Tijd</label>
                <div class="range-container">
                    <input type="range" id="timeInput" class="range-input" min="4" max="45" step="1" value="20">
                    <span id="timeDisplay" class="range-value">20 min</span>
                </div>
            </div>

            <!-- Level -->
            <div class="form-group">
                <label class="form-group__label">Jouw Niveau</label>
                <span class="form-group__sub">Bepaalt de werk/rust verhouding</span>
                <div class="option-grid">
                    <input type="radio" name="level" id="lvl-beg" value="beginner" class="option-input">
                    <label for="lvl-beg" class="option-label">
                        <span class="icon">üå±</span>
                        Beginner<br><small>30s / 30s</small>
                    </label>

                    <input type="radio" name="level" id="lvl-int" value="intermediate" class="option-input" checked>
                    <label for="lvl-int" class="option-label">
                        <span class="icon">üí™</span>
                        Fit<br><small>40s / 20s</small>
                    </label>

                    <input type="radio" name="level" id="lvl-adv" value="advanced" class="option-input">
                    <label for="lvl-adv" class="option-label">
                        <span class="icon">üèÜ</span>
                        Atleet<br><small>45s / 15s</small>
                    </label>

                    <input type="radio" name="level" id="lvl-tabata" value="tabata" class="option-input">
                    <label for="lvl-tabata" class="option-label">
                        <span class="icon">üî•</span>
                        Tabata<br><small>20s / 10s</small>
                    </label>
                </div>
            </div>

            <!-- Focus -->
            <div class="form-group">
                <label class="form-group__label">Focus Gebied</label>
                <div class="option-grid">
                    <input type="radio" name="focus" id="focus-full" value="full" class="option-input" checked>
                    <label for="focus-full" class="option-label">
                        <span class="icon">üéØ</span>
                        Full Body
                    </label>
                    <input type="radio" name="focus" id="focus-cardio" value="cardio" class="option-input">
                    <label for="focus-cardio" class="option-label">
                        <span class="icon">‚ù§Ô∏è</span>
                        Cardio
                    </label>
                    <input type="radio" name="focus" id="focus-legs" value="legs" class="option-input">
                    <label for="focus-legs" class="option-label">
                        <span class="icon">ü¶µ</span>
                        Benen
                    </label>
                    <input type="radio" name="focus" id="focus-arms" value="arms" class="option-input">
                    <label for="focus-arms" class="option-label">
                        <span class="icon">üí™</span>
                        Armen
                    </label>
                    <input type="radio" name="focus" id="focus-core" value="core" class="option-input">
                    <label for="focus-core" class="option-label">
                        <span class="icon">üî•</span>
                        Core
                    </label>
                </div>
            </div>

            <!-- Gear -->
            <div class="form-group">
                <label class="form-group__label">Beschikbaar Materiaal</label>
                <span class="form-group__sub">Selecteer wat je hebt</span>
                <div class="option-grid option-grid--gear">
                    <input type="checkbox" id="gear-chair" value="chair" class="option-input">
                    <label for="gear-chair" class="option-label">
                        <span class="icon">ü™ë</span>
                        Stoel
                    </label>
                    
                    <input type="checkbox" id="gear-wall" value="wall" class="option-input">
                    <label for="gear-wall" class="option-label">
                        <span class="icon">üß±</span>
                        Muur
                    </label>
                    
                    <input type="checkbox" id="gear-kettle" value="kettle" class="option-input">
                    <label for="gear-kettle" class="option-label">
                        <span class="icon">üèãÔ∏è</span>
                        Kettlebell
                    </label>
                    
                    <input type="checkbox" id="gear-dumbbell" value="dumbbell" class="option-input">
                    <label for="gear-dumbbell" class="option-label">
                        <span class="icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>
                        Dumbbells
                    </label>
                    
                    <input type="checkbox" id="gear-pullup" value="pullup" class="option-input">
                    <label for="gear-pullup" class="option-label">
                        <span class="icon">üî©</span>
                        Pull-up Bar
                    </label>
                    
                    <input type="checkbox" id="gear-band" value="band" class="option-input">
                    <label for="gear-band" class="option-label">
                        <span class="icon">üéóÔ∏è</span>
                        Resistance Band
                    </label>
                    
                    <input type="checkbox" id="gear-rope" value="rope" class="option-input">
                    <label for="gear-rope" class="option-label">
                        <span class="icon">ü™¢</span>
                        Springtouw
                    </label>
                    
                    <input type="checkbox" id="gear-bench" value="bench" class="option-input">
                    <label for="gear-bench" class="option-label">
                        <span class="icon">üõãÔ∏è</span>
                        Bank/Bench
                    </label>
                    
                    <input type="checkbox" id="gear-ball" value="ball" class="option-input">
                    <label for="gear-ball" class="option-label">
                        <span class="icon">‚öΩ</span>
                        Medicine Ball
                    </label>
                </div>
            </div>

            <button id="generateBtn" class="btn btn--primary">Genereer Workout</button>
        </div>

        <!-- Preview Section -->
        <div id="previewSection" class="hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <span id="totalRounds" class="stat-card__value">0</span>
                    <span class="stat-card__label">Rondes</span>
                </div>
                <div class="stat-card">
                    <span id="totalTime" class="stat-card__value">0</span>
                    <span class="stat-card__label">Minuten</span>
                </div>
                <div class="stat-card">
                    <span id="estBurn" class="stat-card__value">0</span>
                    <span class="stat-card__label">Kcal (est)</span>
                </div>
            </div>

            <button id="startPlayerBtn" class="btn btn--primary">START WORKOUT ‚ñ∂</button>

            <div class="timeline" id="workoutTimeline"></div>

            <button id="resetBtn" class="btn btn--secondary">‚Üê Terug naar Setup</button>
        </div>
    </div>

    <!-- HISTORY PANEL -->
    <div id="historyPanel" class="panel">
        <div id="historyContent"></div>
    </div>
</div>

<!-- PLAYER OVERLAY -->
<div id="playerOverlay" class="player-overlay">
    <div class="player-header">
        <div id="playerPhase" class="player-phase">WARMING UP</div>
        <div class="player-progress">
            <span id="playerCurrentRound">1</span> / <span id="playerTotalRounds">20</span>
        </div>
    </div>

    <div class="player-main">
        <div id="playerExerciseName" class="current-move">Burpees</div>
        <div id="playerTimer" class="timer-big">40</div>
        <div id="playerTip" class="current-tip">Tip: Houd je rug recht.</div>
        
        <div class="time-adjust">
            <button id="subTimeBtn" class="time-adjust-btn">-10s</button>
            <button id="addTimeBtn" class="time-adjust-btn">+10s</button>
        </div>
    </div>

    <div class="up-next">
        <span class="up-next__label">Hierna:</span>
        <span id="playerNextName" class="up-next__name">Rust</span>
    </div>

    <div class="player-controls">
        <button id="skipBtn" class="btn btn-control btn-skip">Skip ‚Üí</button>
        <button id="toggleTimerBtn" class="btn btn-control btn-pause">Pauze</button>
        <button id="exitPlayerBtn" class="btn btn-control btn-stop">Stop</button>
    </div>
</div>

<!-- COMPLETION OVERLAY -->
<div id="completionOverlay" class="completion-overlay">
    <div class="completion__icon">üéâ</div>
    <h2 class="completion__title">Workout Voltooid!</h2>
    <p class="completion__subtitle">Goed gewerkt, kampioen!</p>
    
    <div class="completion__stats">
        <div class="completion__stat">
            <span id="completionRounds" class="completion__stat-value">0</span>
            <span class="completion__stat-label">Rondes</span>
        </div>
        <div class="completion__stat">
            <span id="completionTime" class="completion__stat-value">0</span>
            <span class="completion__stat-label">Minuten</span>
        </div>
        <div class="completion__stat">
            <span id="completionKcal" class="completion__stat-value">0</span>
            <span class="completion__stat-label">Kcal</span>
        </div>
    </div>
    
    <button id="completionCloseBtn" class="btn btn--primary" style="max-width: 300px;">Terug naar Home</button>
</div>

<script>
    /* ========================================
       EXERCISE DATABASE
    ======================================== */
    const exercises = [
        // CARDIO / FULL BODY (no gear)
        { id: 'burpees', name: 'Burpees', type: 'full', gear: 'none', tip: "Niet inzakken in je onderrug bij de push-up." },
        { id: 'jumping-jacks', name: 'Jumping Jacks', type: 'cardio', gear: 'none', tip: "Houd je core aangespannen, land zachtjes." },
        { id: 'mountain-climbers', name: 'Mountain Climbers', type: 'cardio', gear: 'none', tip: "Knie√´n recht naar voren, billen laag." },
        { id: 'high-knees', name: 'High Knees', type: 'cardio', gear: 'none', tip: "Knie√´n tot heuphoogte, tempo hoog!" },
        { id: 'skater-jumps', name: 'Skater Jumps', type: 'cardio', gear: 'none', tip: "Zwaai je armen mee voor balans." },
        { id: 'plank-jacks', name: 'Plank Jacks', type: 'cardio', gear: 'none', tip: "Blijf strak in de plank, spring alleen met je voeten." },
        { id: 'star-jumps', name: 'Star Jumps', type: 'cardio', gear: 'none', tip: "Explosief omhoog, armen en benen wijd." },
        { id: 'tuck-jumps', name: 'Tuck Jumps', type: 'cardio', gear: 'none', tip: "Knie√´n naar je borst in de lucht." },
        
        // LEGS (no gear)
        { id: 'squats', name: 'Air Squats', type: 'legs', gear: 'none', tip: "Gewicht op je hielen, borst vooruit." },
        { id: 'jump-squats', name: 'Jump Squats', type: 'legs', gear: 'none', tip: "Explosief omhoog, zachte landing." },
        { id: 'lunges', name: 'Walking Lunges', type: 'legs', gear: 'none', tip: "Achterste knie raakt net niet de grond." },
        { id: 'sumo-squats', name: 'Sumo Squats', type: 'legs', gear: 'none', tip: "Voeten wijd, tenen naar buiten." },
        { id: 'calf-raises', name: 'Calf Raises', type: 'legs', gear: 'none', tip: "Hoog op je tenen, langzaam zakken." },
        { id: 'glute-bridge', name: 'Glute Bridges', type: 'legs', gear: 'none', tip: "Knijp je billen samen bovenaan." },
        
        // ARMS / UPPER (no gear)
        { id: 'pushups', name: 'Push-ups', type: 'arms', gear: 'none', tip: "Elleboog in 45 graden, niet wijd." },
        { id: 'diamond-pushups', name: 'Diamond Push-ups', type: 'arms', gear: 'none', tip: "Handen tegen elkaar, focus op triceps." },
        { id: 'pike-pushups', name: 'Pike Push-ups', type: 'arms', gear: 'none', tip: "Billen hoog in de lucht, focus op schouders." },
        { id: 'wide-pushups', name: 'Wide Push-ups', type: 'arms', gear: 'none', tip: "Handen wijder dan schouderbreedte." },
        
        // CORE (no gear)
        { id: 'plank', name: 'Plank', type: 'core', gear: 'none', tip: "Navel intrekken, bilspieren aanspannen." },
        { id: 'shoulder-taps', name: 'Plank Shoulder Taps', type: 'core', gear: 'none', tip: "Houd je heupen zo stil mogelijk." },
        { id: 'bicycle-crunches', name: 'Bicycle Crunches', type: 'core', gear: 'none', tip: "Draai vanuit je borst, niet trekken aan je nek." },
        { id: 'leg-raises', name: 'Leg Raises', type: 'core', gear: 'none', tip: "Onderrug in de grond duwen, benen gestrekt." },
        { id: 'dead-bug', name: 'Dead Bug', type: 'core', gear: 'none', tip: "Onderrug blijft plat op de grond." },
        { id: 'flutter-kicks', name: 'Flutter Kicks', type: 'core', gear: 'none', tip: "Kleine snelle bewegingen, rug plat." },
        { id: 'v-ups', name: 'V-Ups', type: 'core', gear: 'none', tip: "Raak je tenen aan bovenaan." },

        // CHAIR exercises
        { id: 'step-ups', name: 'Step Ups', type: 'legs', gear: 'chair', tip: "Duw vanuit je hele voet omhoog." },
        { id: 'bulgarian-split', name: 'Bulgarian Split Squat', type: 'legs', gear: 'chair', tip: "Voet op de stoel achter je, diep zakken." },
        { id: 'dips', name: 'Tricep Dips', type: 'arms', gear: 'chair', tip: "Rug vlak langs de stoel laten zakken." },
        { id: 'incline-pushups', name: 'Incline Push-ups', type: 'arms', gear: 'chair', tip: "Handen op de stoel, lichaam als een plank." },
        { id: 'decline-pushups', name: 'Decline Push-ups', type: 'arms', gear: 'chair', tip: "Voeten op de stoel, handen op de grond. Zwaar!" },

        // WALL exercises
        { id: 'wall-sit', name: 'Wall Sit', type: 'legs', gear: 'wall', tip: "90 graden hoek, handen niet op je knie√´n!" },
        { id: 'wall-pushups', name: 'Wall Push-ups', type: 'arms', gear: 'wall', tip: "Perfect voor beginners of als warming-up." },

        // KETTLEBELL exercises
        { id: 'kb-swing', name: 'Kettlebell Swings', type: 'full', gear: 'kettle', tip: "Heupbeweging! Niet tillen met je schouders." },
        { id: 'kb-goblet', name: 'Goblet Squats', type: 'legs', gear: 'kettle', tip: "Houd de bel tegen je borst, ellebogen naar binnen." },
        { id: 'kb-press', name: 'KB Overhead Press', type: 'arms', gear: 'kettle', tip: "Core strak, duw recht omhoog." },
        { id: 'kb-row', name: 'KB Bent Over Row', type: 'arms', gear: 'kettle', tip: "Rug recht, trek elleboog langs je zij." },
        { id: 'kb-lunge', name: 'KB Lunges', type: 'legs', gear: 'kettle', tip: "Houd de bel in √©√©n hand of tegen je borst." },
        { id: 'kb-twist', name: 'Russian Twists', type: 'core', gear: 'kettle', tip: "Voeten van de vloer voor extra uitdaging." },
        { id: 'kb-deadlift', name: 'KB Deadlift', type: 'legs', gear: 'kettle', tip: "Rug recht, duw heupen naar achteren." },

        // DUMBBELL exercises
        { id: 'db-curl', name: 'Bicep Curls', type: 'arms', gear: 'dumbbell', tip: "Ellebogen stil houden, alleen onderarm beweegt." },
        { id: 'db-press', name: 'Shoulder Press', type: 'arms', gear: 'dumbbell', tip: "Duw recht omhoog, niet naar voren." },
        { id: 'db-row', name: 'Dumbbell Rows', type: 'arms', gear: 'dumbbell', tip: "Trek elleboog naar het plafond." },
        { id: 'db-squat', name: 'Dumbbell Squats', type: 'legs', gear: 'dumbbell', tip: "Dumbbells langs je zij of op schouders." },
        { id: 'db-lunge', name: 'Dumbbell Lunges', type: 'legs', gear: 'dumbbell', tip: "Houd je romp rechtop." },
        { id: 'db-flyes', name: 'Chest Flyes', type: 'arms', gear: 'dumbbell', tip: "Lichte buiging in ellebogen, wijd openen." },
        { id: 'db-thruster', name: 'Thrusters', type: 'full', gear: 'dumbbell', tip: "Squat + press in √©√©n vloeiende beweging." },
        { id: 'db-snatch', name: 'Dumbbell Snatch', type: 'full', gear: 'dumbbell', tip: "Explosief vanuit de heupen." },
        { id: 'db-rdl', name: 'Romanian Deadlift', type: 'legs', gear: 'dumbbell', tip: "Hamstrings op spanning, rug recht." },
        { id: 'renegade-row', name: 'Renegade Rows', type: 'arms', gear: 'dumbbell', tip: "Heupen stil, afwisselend roeien." },

        // PULL-UP BAR exercises
        { id: 'pullups', name: 'Pull-ups', type: 'arms', gear: 'pullup', tip: "Kin boven de stang, gecontroleerd zakken." },
        { id: 'chinups', name: 'Chin-ups', type: 'arms', gear: 'pullup', tip: "Handpalmen naar je toe, focus op biceps." },
        { id: 'hanging-knee', name: 'Hanging Knee Raises', type: 'core', gear: 'pullup', tip: "Niet zwaaien, trek je knie√´n naar je borst." },
        { id: 'dead-hang', name: 'Active Dead Hang', type: 'arms', gear: 'pullup', tip: "Schouders laag houden, gewoon hangen." },
        { id: 'hanging-leg', name: 'Hanging Leg Raises', type: 'core', gear: 'pullup', tip: "Benen gestrekt, gecontroleerd omhoog." },

        // RESISTANCE BAND exercises
        { id: 'band-pull-apart', name: 'Band Pull Aparts', type: 'arms', gear: 'band', tip: "Schouderbladen naar elkaar toe knijpen." },
        { id: 'band-rows', name: 'Band Rows', type: 'arms', gear: 'band', tip: "Ellebogen langs je lichaam trekken." },
        { id: 'band-squat', name: 'Banded Squats', type: 'legs', gear: 'band', tip: "Band rond bovenbenen, knie√´n naar buiten." },
        { id: 'band-press', name: 'Band Chest Press', type: 'arms', gear: 'band', tip: "Band achter je rug, naar voren duwen." },
        { id: 'band-deadlift', name: 'Band Deadlifts', type: 'legs', gear: 'band', tip: "Sta op de band, trek omhoog." },
        { id: 'band-curl', name: 'Band Bicep Curls', type: 'arms', gear: 'band', tip: "Sta op de band, curl omhoog." },
        { id: 'band-kickback', name: 'Band Glute Kickback', type: 'legs', gear: 'band', tip: "Band rond enkels, been naar achteren." },
        { id: 'band-lateral', name: 'Band Lateral Walks', type: 'legs', gear: 'band', tip: "Band rond bovenbenen, zijwaarts stappen." },

        // JUMP ROPE exercises
        { id: 'rope-basic', name: 'Basic Jump Rope', type: 'cardio', gear: 'rope', tip: "Kleine sprongetjes, polsen draaien." },
        { id: 'rope-high-knee', name: 'High Knee Jump Rope', type: 'cardio', gear: 'rope', tip: "Knie√´n hoog, tempo vasthouden." },
        { id: 'rope-double', name: 'Double Unders', type: 'cardio', gear: 'rope', tip: "Touw 2x onder je door per sprong." },
        { id: 'rope-boxer', name: 'Boxer Skip', type: 'cardio', gear: 'rope', tip: "Van voet naar voet wisselen." },

        // BENCH exercises
        { id: 'bench-press', name: 'Bench Push-ups', type: 'arms', gear: 'bench', tip: "Handen op de bank, lichaam recht." },
        { id: 'bench-dips', name: 'Bench Dips', type: 'arms', gear: 'bench', tip: "Handen achter je, zakken en duwen." },
        { id: 'bench-step', name: 'Bench Step-ups', type: 'legs', gear: 'bench', tip: "Hoger dan een stoel, meer intensiteit." },
        { id: 'bench-hop', name: 'Bench Hop Overs', type: 'cardio', gear: 'bench', tip: "Spring lateraal over de bank." },
        { id: 'box-jump', name: 'Box Jumps', type: 'legs', gear: 'bench', tip: "Explosief omhoog, zachte landing." },

        // MEDICINE BALL exercises
        { id: 'ball-slam', name: 'Ball Slams', type: 'full', gear: 'ball', tip: "Gooi met volle kracht naar de grond." },
        { id: 'ball-squat', name: 'Ball Squats', type: 'legs', gear: 'ball', tip: "Bal tegen je borst houden." },
        { id: 'ball-twist', name: 'Ball Russian Twist', type: 'core', gear: 'ball', tip: "Raak de grond links en rechts aan." },
        { id: 'ball-throw', name: 'Ball Chest Pass', type: 'arms', gear: 'ball', tip: "Explosief naar voren gooien." },
        { id: 'ball-crunch', name: 'Ball Crunches', type: 'core', gear: 'ball', tip: "Bal boven je hoofd, raak je tenen aan." },
        { id: 'ball-lunge', name: 'Ball Lunges', type: 'legs', gear: 'ball', tip: "Bal boven je hoofd tijdens de lunge." },
    ];

    /* ========================================
       GLOBAL STATE
    ======================================== */
    let currentWorkout = [];
    let playerInterval = null;
    let currentStepIndex = 0;
    let timeLeft = 0;
    let isPaused = false;
    let wakeLock = null;
    let workoutStartTime = null;
    let totalWorkoutRounds = 0;
    let estimatedKcal = 0;

    /* ========================================
       DOM ELEMENTS
    ======================================== */
    const timeInput = document.getElementById('timeInput');
    const timeDisplay = document.getElementById('timeDisplay');
    const generateBtn = document.getElementById('generateBtn');
    const resetBtn = document.getElementById('resetBtn');
    const startPlayerBtn = document.getElementById('startPlayerBtn');
    const configSection = document.getElementById('configSection');
    const previewSection = document.getElementById('previewSection');
    const timeline = document.getElementById('workoutTimeline');
    const mainApp = document.getElementById('mainApp');
    
    // Player Elements
    const playerOverlay = document.getElementById('playerOverlay');
    const playerPhase = document.getElementById('playerPhase');
    const playerCurrentRound = document.getElementById('playerCurrentRound');
    const playerTotalRounds = document.getElementById('playerTotalRounds');
    const playerExerciseName = document.getElementById('playerExerciseName');
    const playerTimer = document.getElementById('playerTimer');
    const playerTip = document.getElementById('playerTip');
    const playerNextName = document.getElementById('playerNextName');
    const toggleTimerBtn = document.getElementById('toggleTimerBtn');
    const exitPlayerBtn = document.getElementById('exitPlayerBtn');
    const skipBtn = document.getElementById('skipBtn');
    const addTimeBtn = document.getElementById('addTimeBtn');
    const subTimeBtn = document.getElementById('subTimeBtn');

    // Completion
    const completionOverlay = document.getElementById('completionOverlay');
    const completionCloseBtn = document.getElementById('completionCloseBtn');

    // Nav tabs
    const navTabs = document.querySelectorAll('.nav-tab');
    const panels = document.querySelectorAll('.panel');

    /* ========================================
       EVENT LISTENERS
    ======================================== */
    timeInput.addEventListener('input', (e) => timeDisplay.textContent = `${e.target.value} min`);
    generateBtn.addEventListener('click', generateWorkout);
    resetBtn.addEventListener('click', showConfig);
    startPlayerBtn.addEventListener('click', startPlayer);
    exitPlayerBtn.addEventListener('click', () => stopPlayer(false));
    toggleTimerBtn.addEventListener('click', togglePause);
    skipBtn.addEventListener('click', skipStep);
    addTimeBtn.addEventListener('click', () => adjustTime(10));
    subTimeBtn.addEventListener('click', () => adjustTime(-10));
    completionCloseBtn.addEventListener('click', closeCompletion);

    // Nav tabs
    navTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            navTabs.forEach(t => t.classList.remove('nav-tab--active'));
            tab.classList.add('nav-tab--active');
            
            panels.forEach(p => p.classList.remove('panel--active'));
            document.getElementById(`${tab.dataset.tab}Panel`).classList.add('panel--active');
            
            if (tab.dataset.tab === 'history') renderHistory();
        });
    });

    // Presets
    document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', () => applyPreset(btn.dataset.preset));
    });

    /* ========================================
       PRESETS
    ======================================== */
    function applyPreset(preset) {
        switch(preset) {
            case 'quick':
                timeInput.value = 10;
                document.getElementById('lvl-int').checked = true;
                break;
            case 'tabata':
                timeInput.value = 4;
                document.getElementById('lvl-tabata').checked = true;
                break;
            case 'standard':
                timeInput.value = 20;
                document.getElementById('lvl-int').checked = true;
                break;
            case 'endurance':
                timeInput.value = 30;
                document.getElementById('lvl-beg').checked = true;
                break;
        }
        timeDisplay.textContent = `${timeInput.value} min`;
        vibrate(50);
    }

    /* ========================================
       HAPTIC FEEDBACK
    ======================================== */
    function vibrate(pattern) {
        if ('vibrate' in navigator) {
            navigator.vibrate(pattern);
        }
    }

    /* ========================================
       WORKOUT GENERATOR
    ======================================== */
    function generateWorkout() {
        vibrate(100);
        
        const duration = parseInt(timeInput.value);
        const focus = document.querySelector('input[name="focus"]:checked').value;
        const level = document.querySelector('input[name="level"]:checked').value;
        
        const gear = {
            chair: document.getElementById('gear-chair').checked,
            wall: document.getElementById('gear-wall').checked,
            kettle: document.getElementById('gear-kettle').checked,
            dumbbell: document.getElementById('gear-dumbbell').checked,
            pullup: document.getElementById('gear-pullup').checked,
            band: document.getElementById('gear-band').checked,
            rope: document.getElementById('gear-rope').checked,
            bench: document.getElementById('gear-bench').checked,
            ball: document.getElementById('gear-ball').checked,
        };

        // Level ratios
        let workTime = 40, restTime = 20;
        if (level === 'beginner') { workTime = 30; restTime = 30; }
        if (level === 'advanced') { workTime = 45; restTime = 15; }
        if (level === 'tabata') { workTime = 20; restTime = 10; }

        // Filter exercises
        let availableMoves = exercises.filter(ex => {
            if (ex.gear !== 'none' && !gear[ex.gear]) return false;
            
            if (focus === 'full') return true;
            if (focus === 'cardio') return ex.type === 'cardio' || ex.type === 'full';
            if (focus === 'legs') return ex.type === 'legs' || ex.type === 'full';
            if (focus === 'arms') return ex.type === 'arms' || ex.type === 'full';
            if (focus === 'core') return ex.type === 'core' || ex.type === 'full';
            
            return false;
        });

        // Fallback
        if (availableMoves.length < 4) {
            const fillers = exercises.filter(ex => ex.gear === 'none' && (ex.type === focus || ex.type === 'full' || ex.type === 'cardio'));
            availableMoves = [...new Set([...availableMoves, ...fillers])];
            if (availableMoves.length < 4) availableMoves = exercises.filter(ex => ex.gear === 'none');
        }

        // Build structure
        const isTabata = level === 'tabata';
        const warmupDuration = isTabata ? 60 : 120;
        const cooldownDuration = isTabata ? 60 : 120;
        const roundDuration = workTime + restTime;
        const totalSeconds = duration * 60;
        const workSeconds = totalSeconds - warmupDuration - cooldownDuration;
        const rounds = Math.max(1, Math.floor(workSeconds / roundDuration));

        currentWorkout = [];
        
        // Warmup
        currentWorkout.push({
            type: 'warmup',
            name: 'Warming Up',
            duration: warmupDuration,
            desc: 'Dribbelen, armen zwaaien. Hartslag omhoog.',
            tip: 'Focus op ademhaling, maak je lichaam wakker.'
        });

        // Rounds
        let lastMoveId = null;
        for (let i = 0; i < rounds; i++) {
            let possiblePicks = availableMoves.filter(m => m.id !== lastMoveId);
            if (possiblePicks.length === 0) possiblePicks = availableMoves;

            const move = possiblePicks[Math.floor(Math.random() * possiblePicks.length)];
            lastMoveId = move.id;

            currentWorkout.push({
                type: 'work',
                name: move.name,
                duration: workTime,
                desc: 'Geef alles!',
                tip: move.tip,
                gear: move.gear
            });

            if (i < rounds - 1) {
                currentWorkout.push({
                    type: 'rest',
                    name: 'Rust',
                    duration: restTime,
                    desc: 'Ademhalen',
                    tip: 'Blijf in beweging, dribbelen op de plaats.'
                });
            }
        }

        // Cooldown
        currentWorkout.push({
            type: 'warmup',
            name: 'Cooling Down',
            duration: cooldownDuration,
            desc: 'Rustig uitlopen en rekken.',
            tip: 'Hartslag omlaag, goed gedaan!'
        });

        // Stats
        totalWorkoutRounds = rounds;
        estimatedKcal = rounds * (level === 'advanced' ? 16 : level === 'tabata' ? 14 : 12) + 20;
        
        document.getElementById('totalRounds').textContent = rounds;
        document.getElementById('totalTime').textContent = duration;
        document.getElementById('estBurn').textContent = estimatedKcal;
        
        renderTimeline(currentWorkout);
        
        configSection.classList.add('hidden');
        previewSection.classList.remove('hidden');
    }

    function renderTimeline(plan) {
        timeline.innerHTML = '';
        plan.forEach(item => {
            const div = document.createElement('div');
            let modifier = '';
            if (item.type === 'warmup') modifier = 'timeline-item--warmup';
            if (item.type === 'work') modifier = 'timeline-item--high';
            if (item.type === 'rest') modifier = 'timeline-item--rest';

            div.className = `timeline-item ${modifier}`;
            div.innerHTML = `
                <div class="timeline-item__info">
                    <div class="timeline-item__title">${item.name}</div>
                    <div class="timeline-item__desc">${item.desc}</div>
                </div>
                <div class="timeline-item__time">${item.duration}s</div>
            `;
            timeline.appendChild(div);
        });
    }

    function showConfig() {
        previewSection.classList.add('hidden');
        configSection.classList.remove('hidden');
    }

    /* ========================================
       PLAYER LOGIC
    ======================================== */
    async function startPlayer() {
        vibrate([100, 50, 100]);
        
        mainApp.style.display = 'none';
        playerOverlay.classList.add('player--active');
        
        if ('wakeLock' in navigator) {
            try { wakeLock = await navigator.wakeLock.request('screen'); } 
            catch (err) { console.log('Wake Lock failed', err); }
        }

        workoutStartTime = Date.now();
        currentStepIndex = 0;
        isPaused = false;
        loadStep(currentStepIndex);
        
        playerInterval = setInterval(tick, 1000);
    }

    function stopPlayer(completed = false) {
        clearInterval(playerInterval);
        if (wakeLock) { wakeLock.release(); wakeLock = null; }
        
        playerOverlay.classList.remove('player--active');
        playerOverlay.className = 'player-overlay';
        
        if (completed) {
            showCompletion();
        } else {
            mainApp.style.display = 'block';
        }
    }

    function togglePause() {
        isPaused = !isPaused;
        vibrate(50);
        
        toggleTimerBtn.textContent = isPaused ? "Hervat" : "Pauze";
        toggleTimerBtn.classList.toggle('btn-pause--paused', isPaused);
    }

    function skipStep() {
        vibrate(50);
        currentStepIndex++;
        loadStep(currentStepIndex);
    }

    function adjustTime(seconds) {
        vibrate(30);
        timeLeft = Math.max(1, timeLeft + seconds);
        playerTimer.textContent = timeLeft;
    }

    function loadStep(index) {
        if (index >= currentWorkout.length) {
            finishWorkout();
            return;
        }

        const step = currentWorkout[index];
        timeLeft = step.duration;
        
        // Update visuals
        playerExerciseName.textContent = step.name;
        playerTip.textContent = step.tip || "";
        playerTimer.textContent = timeLeft;

        // Phase styling
        playerPhase.className = 'player-phase';
        playerOverlay.className = 'player-overlay player--active';
        
        if (step.type === 'warmup') {
            playerPhase.textContent = step.name.toUpperCase();
            playerPhase.classList.add('player-phase--warmup');
            playerOverlay.classList.add('player--warmup');
        } else if (step.type === 'work') {
            playerPhase.textContent = 'WERKEN';
            playerPhase.classList.add('player-phase--work');
            playerOverlay.classList.add('player--work');
        } else {
            playerPhase.textContent = 'RUST';
            playerPhase.classList.add('player-phase--rest');
            playerOverlay.classList.add('player--rest');
        }

        // Up next
        const nextStep = currentWorkout[index + 1];
        playerNextName.textContent = nextStep ? nextStep.name : "Klaar! üéâ";

        // Round counter
        const totalWorkRounds = currentWorkout.filter(s => s.type === 'work').length;
        const currentWorkRound = currentWorkout.slice(0, index + 1).filter(s => s.type === 'work').length;
        
        if (step.type === 'work' || step.type === 'rest') {
            playerCurrentRound.textContent = Math.max(1, currentWorkRound);
            playerTotalRounds.textContent = totalWorkRounds;
        } else {
            playerCurrentRound.textContent = "-";
            playerTotalRounds.textContent = "-";
        }
        
        // Haptic + audio on step start
        vibrate(step.type === 'work' ? [100, 50, 100] : 100);
        playBeep(step.type === 'work' ? 880 : 440, 0.15);
    }

    function tick() {
        if (isPaused) return;

        timeLeft--;
        playerTimer.textContent = timeLeft;

        // Countdown beeps
        if (timeLeft > 0 && timeLeft <= 3) {
            playBeep(600, 0.08);
            vibrate(50);
        }

        if (timeLeft <= 0) {
            currentStepIndex++;
            loadStep(currentStepIndex);
        }
    }

    function finishWorkout() {
        const duration = Math.round((Date.now() - workoutStartTime) / 60000);
        
        // Save to history
        saveWorkoutHistory({
            date: new Date().toISOString(),
            rounds: totalWorkoutRounds,
            duration: duration,
            kcal: estimatedKcal,
            focus: document.querySelector('input[name="focus"]:checked').value,
            level: document.querySelector('input[name="level"]:checked').value
        });

        // Update completion stats
        document.getElementById('completionRounds').textContent = totalWorkoutRounds;
        document.getElementById('completionTime').textContent = duration;
        document.getElementById('completionKcal').textContent = estimatedKcal;

        stopPlayer(true);
    }

    /* ========================================
       COMPLETION & CONFETTI
    ======================================== */
    function showCompletion() {
        completionOverlay.classList.add('completion-overlay--active');
        vibrate([100, 100, 100, 100, 200]);
        launchConfetti();
    }

    function closeCompletion() {
        completionOverlay.classList.remove('completion-overlay--active');
        mainApp.style.display = 'block';
        showConfig();
    }

    // Confetti system
    const confettiCanvas = document.getElementById('confettiCanvas');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    let confettiAnimating = false;

    function resizeConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeConfetti);
    resizeConfetti();

    function launchConfetti() {
        confettiPieces = [];
        const colors = ['#FF4D00', '#00D4FF', '#FFD700', '#00ff88', '#ff6b6b', '#4ecdc4'];
        
        for (let i = 0; i < 150; i++) {
            confettiPieces.push({
                x: Math.random() * confettiCanvas.width,
                y: Math.random() * confettiCanvas.height - confettiCanvas.height,
                size: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 2 - 1,
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 10 - 5
            });
        }
        
        if (!confettiAnimating) {
            confettiAnimating = true;
            animateConfetti();
        }
    }

    function animateConfetti() {
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        
        let activeCount = 0;
        confettiPieces.forEach(p => {
            if (p.y < confettiCanvas.height + 20) {
                activeCount++;
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += p.rotationSpeed;
                
                confettiCtx.save();
                confettiCtx.translate(p.x, p.y);
                confettiCtx.rotate(p.rotation * Math.PI / 180);
                confettiCtx.fillStyle = p.color;
                confettiCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size * 0.6);
                confettiCtx.restore();
            }
        });
        
        if (activeCount > 0) {
            requestAnimationFrame(animateConfetti);
        } else {
            confettiAnimating = false;
        }
    }

    /* ========================================
       AUDIO
    ======================================== */
    let audioCtx = null;
    
    function getAudioContext() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        return audioCtx;
    }

    function playBeep(freq, duration) {
        try {
            const ctx = getAudioContext();
            if (ctx.state === 'suspended') ctx.resume();
            
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = freq;
            
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
            
            oscillator.start();
            oscillator.stop(ctx.currentTime + duration);
        } catch(e) {
            console.log('Audio error', e);
        }
    }

    /* ========================================
       HISTORY (localStorage)
    ======================================== */
    const HISTORY_KEY = 'hiit_architect_history';

    function getHistory() {
        try {
            return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
        } catch {
            return [];
        }
    }

    function saveWorkoutHistory(workout) {
        const history = getHistory();
        history.unshift(workout);
        // Keep last 50
        if (history.length > 50) history.pop();
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    }

    function clearHistory() {
        if (confirm('Weet je zeker dat je alle geschiedenis wilt wissen?')) {
            localStorage.removeItem(HISTORY_KEY);
            renderHistory();
        }
    }

    function renderHistory() {
        const container = document.getElementById('historyContent');
        const history = getHistory();

        if (history.length === 0) {
            container.innerHTML = `
                <div class="history-empty">
                    <div class="history-empty__icon">üìä</div>
                    <p>Nog geen workouts voltooid.</p>
                    <p style="font-size: 0.85rem;">Start je eerste workout om je voortgang te zien!</p>
                </div>
            `;
            return;
        }

        const focusLabels = { full: 'Full Body', cardio: 'Cardio', legs: 'Benen', arms: 'Armen', core: 'Core' };
        const levelLabels = { beginner: 'Beginner', intermediate: 'Fit', advanced: 'Atleet', tabata: 'Tabata' };

        let html = '<div class="history-list">';
        
        history.forEach(w => {
            const date = new Date(w.date);
            const dateStr = date.toLocaleDateString('nl-NL', { 
                weekday: 'short', 
                day: 'numeric', 
                month: 'short',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div class="history-item">
                    <div class="history-item__header">
                        <span class="history-item__date">${dateStr}</span>
                        <span class="history-item__badge">${focusLabels[w.focus] || w.focus}</span>
                    </div>
                    <div class="history-item__stats">
                        <span><strong>${w.rounds}</strong> rondes</span>
                        <span><strong>${w.duration}</strong> min</span>
                        <span><strong>${w.kcal}</strong> kcal</span>
                        <span>${levelLabels[w.level] || w.level}</span>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        html += `
            <div class="history-actions">
                <button class="btn btn--secondary" onclick="clearHistory()">Geschiedenis Wissen</button>
            </div>
        `;
        
        container.innerHTML = html;
    }

    // Expose clearHistory globally
    window.clearHistory = clearHistory;

</script>

</body>
</html>
