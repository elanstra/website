<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Essentials -->
    <title>ZomerPlanner - Vind jouw ideale vakantieweek in Nederland | KNMI Data</title>
    <meta name="description" content="Ontdek de beste week voor jouw Nederlandse zomervakantie. Interactieve tool gebaseerd op KNMI klimaatdata (1991-2020). Vergelijk temperatuur, zonuren en regenrisico.">
    <meta name="keywords" content="vakantie planner, Nederlandse zomer, KNMI weer, beste vakantieweek, zomervakantie Nederland, schoolvakanties">
    <meta name="author" content="ZomerPlanner NL">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://zomerplanner.nl/">
    
    <!-- Hreflang for potential international versions -->
    <link rel="alternate" hreflang="nl" href="https://zomerplanner.nl/">
    <link rel="alternate" hreflang="nl-BE" href="https://zomerplanner.nl/be/">
    <link rel="alternate" hreflang="de" href="https://zomerplanner.nl/de/">
    <link rel="alternate" hreflang="x-default" href="https://zomerplanner.nl/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://zomerplanner.nl/">
    <meta property="og:title" content="ZomerPlanner - Vind jouw ideale vakantieweek">
    <meta property="og:description" content="Interactieve tool om de perfecte vakantieweek te vinden. Gebaseerd op 30 jaar KNMI klimaatdata.">
    <meta property="og:image" content="https://zomerplanner.nl/og-image.jpg">
    <meta property="og:locale" content="nl_NL">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ZomerPlanner - Vind jouw ideale vakantieweek">
    <meta name="twitter:description" content="Interactieve tool om de perfecte vakantieweek te vinden.">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF8BA7" id="theme-color-meta">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ZomerPlanner">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23FFF8F4' width='180' height='180' rx='32'/><text x='90' y='125' font-size='100' text-anchor='middle'>‚òÄÔ∏è</text></svg>">
    
    <!-- Structured Data - WebApplication -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ZomerPlanner",
        "description": "Interactieve tool om de beste vakantieweek in Nederland te vinden op basis van KNMI klimaatdata",
        "url": "https://zomerplanner.nl",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "EUR"
        },
        "author": {
            "@type": "Organization",
            "name": "ZomerPlanner NL"
        }
    }
    </script>
    
    <!-- Structured Data - FAQ -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "Wanneer is de beste week voor vakantie in Nederland?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Statistisch gezien zijn week 30 en 31 (eind juli/begin augustus) gemiddeld het warmst en zonnigst. Maar dit hangt af van je voorkeuren - sommige mensen geven de voorkeur aan het koelere weer in juni of september."
                }
            },
            {
                "@type": "Question",
                "name": "Hoe betrouwbaar zijn de weervoorspellingen?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ZomerPlanner gebruikt gemiddelden van KNMI data over 30 jaar (1991-2020). Dit geeft een indicatie van de 'kans' op goed weer, maar het Nederlandse weer blijft onvoorspelbaar. Resultaten bieden geen garantie."
                }
            },
            {
                "@type": "Question",
                "name": "Is het rustiger buiten de schoolvakanties?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Ja, buiten de schoolvakanties (vooral buiten de bouwvak in week 31-33) zijn toeristische bestemmingen rustiger en vaak goedkoper. Week 24-26 (juni) biedt vaak een goede balans tussen weer en drukte."
                }
            },
            {
                "@type": "Question",
                "name": "Wat is het verschil tussen kust en binnenland?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "De kust is gemiddeld 3-5 graden koeler in de zomer door de zeewind, ideaal tijdens hittegolven. Het binnenland wordt warmer maar heeft ook meer kans op onweersbuien."
                }
            }
        ]
    }
    </script>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    
    <script>
        // Tailwind dark mode config
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        coral: '#FF8BA7',
                        sunny: '#FFD93D',
                        teal: '#6BCB77',
                        cream: '#FFF8F4',
                        'cream-dark': '#1a1a2e'
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: #FFF8F4;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body.dark-mode {
            background-color: #1a1a2e;
            color: #e2e8f0;
        }
        
        /* Dark mode overrides */
        .dark-mode .soft-card {
            background: #16213e;
            border-color: rgba(255,255,255,0.1);
        }
        
        .dark-mode .text-stone-800 { color: #f1f5f9; }
        .dark-mode .text-stone-700 { color: #e2e8f0; }
        .dark-mode .text-stone-600 { color: #cbd5e1; }
        .dark-mode .text-stone-500 { color: #94a3b8; }
        .dark-mode .text-stone-400 { color: #64748b; }
        
        .dark-mode .bg-white { background-color: #1e293b; }
        .dark-mode .bg-stone-50 { background-color: #1e293b; }
        .dark-mode .bg-stone-100 { background-color: #334155; }
        
        .dark-mode .bg-white\/80 { background-color: rgba(30, 41, 59, 0.8); }
        .dark-mode .bg-white\/50 { background-color: rgba(30, 41, 59, 0.5); }
        .dark-mode .bg-white\/60 { background-color: rgba(30, 41, 59, 0.6); }
        
        .dark-mode .border-stone-100 { border-color: #334155; }
        .dark-mode .border-white\/50 { border-color: rgba(255,255,255,0.1); }
        .dark-mode .border-yellow-100 { border-color: rgba(234, 179, 8, 0.2); }
        
        .dark-mode .bg-blue-50 { background-color: rgba(59, 130, 246, 0.15); }
        .dark-mode .bg-green-50 { background-color: rgba(34, 197, 94, 0.15); }
        .dark-mode .bg-orange-50 { background-color: rgba(249, 115, 22, 0.15); }
        .dark-mode .bg-yellow-50 { background-color: rgba(234, 179, 8, 0.15); }
        
        .dark-mode .text-blue-700 { color: #93c5fd; }
        .dark-mode .text-green-700 { color: #86efac; }
        .dark-mode .text-orange-700 { color: #fdba74; }
        
        .dark-mode .border-blue-100 { border-color: rgba(59, 130, 246, 0.3); }
        .dark-mode .border-green-100 { border-color: rgba(34, 197, 94, 0.3); }
        .dark-mode .border-orange-100 { border-color: rgba(249, 115, 22, 0.3); }
        
        .dark-mode input[type=range]::-webkit-slider-thumb {
            border-color: #1e293b;
        }
        
        .dark-mode .bg-\[\#FFE5D9\] { background-color: rgba(255, 229, 217, 0.2); }
        .dark-mode .bg-\[\#FFF4C3\] { background-color: rgba(255, 244, 195, 0.2); }
        .dark-mode .bg-\[\#D0F4F7\] { background-color: rgba(208, 244, 247, 0.2); }
        
        .dark-mode details { background-color: #1e293b; }
        .dark-mode summary { color: #e2e8f0; }
        
        .dark-mode .region-btn { background-color: #1e293b; }
        .dark-mode .region-btn:hover { background-color: #334155; }
        
        .dark-mode footer { background-color: #0f172a; border-color: #1e293b; }
        
        .dark-mode .toast { background-color: #f1f5f9; color: #1e293b; }
        
        .dark-mode .install-prompt { background-color: #1e293b; color: #e2e8f0; }
        
        .extremen-card { background-color: rgba(255,255,255,0.6); }
        .dark-mode .extremen-card { background-color: rgba(30, 41, 59, 0.6); }
        
        #extremes-callout { background: linear-gradient(to right, #fefce8, #fff7ed); }
        .dark-mode #extremes-callout { background: linear-gradient(to right, rgba(234,179,8,0.15), rgba(249,115,22,0.15)); border-color: rgba(234,179,8,0.3); }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            height: 420px;
            min-height: 420px;
        }

        /* Accessible sliders with focus states */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        
        input[type=range]:focus {
            outline: none;
        }
        
        input[type=range]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 4px rgba(255, 139, 167, 0.3);
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #FF8BA7;
            cursor: pointer;
            margin-top: -10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 4px solid white;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #EAEAEA;
            border-radius: 999px;
        }

        #input-temp::-webkit-slider-runnable-track { background: #FFE5D9; }
        #input-sun::-webkit-slider-runnable-track { background: #FFF4C3; }
        #input-rain::-webkit-slider-runnable-track { background: #D0F4F7; }

        .soft-card {
            background: white;
            border-radius: 2rem;
            box-shadow: 0 10px 40px -10px rgba(200, 180, 170, 0.2);
            border: 1px solid rgba(255,255,255,0.8);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .dark-mode .soft-card {
            background: #16213e;
            border-color: rgba(255,255,255,0.1);
        }
        
        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #FF8BA7;
            color: white;
            padding: 8px 16px;
            z-index: 100;
            border-radius: 0 0 8px 0;
            transition: top 0.2s;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Region buttons focus state */
        .region-btn:focus {
            outline: 3px solid #FF8BA7;
            outline-offset: 2px;
        }
        
        /* Top 3 animation */
        .rank-card {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .rank-card.updating {
            transform: scale(0.95);
            opacity: 0.7;
        }
        
        .rank-card.updated {
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0.5; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Share button pulse */
        .share-btn {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 139, 167, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(255, 139, 167, 0); }
        }
        
        /* Dark mode toggle */
        .dark-toggle {
            position: relative;
            width: 56px;
            height: 28px;
            background: #e2e8f0;
            border-radius: 999px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .dark-toggle.active {
            background: #1e293b;
        }
        
        .dark-toggle::after {
            content: '‚òÄÔ∏è';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: transform 0.3s, content 0.3s;
        }
        
        .dark-toggle.active::after {
            content: 'üåô';
            transform: translateX(28px);
        }
        
        /* Drukte indicator */
        .drukte-bar {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #6BCB77 0%, #FFD93D 50%, #FF8BA7 100%);
            position: relative;
        }
        
        .drukte-marker {
            position: absolute;
            top: -4px;
            width: 16px;
            height: 16px;
            background: white;
            border: 3px solid currentColor;
            border-radius: 50%;
            transform: translateX(-50%);
            transition: left 0.3s ease;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* PWA install prompt */
        .install-prompt {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: none;
            align-items: center;
            gap: 16px;
            z-index: 100;
        }
        
        .install-prompt.show {
            display: flex;
        }
        
        /* Comparison mode styles */
        .comparison-active .current-year {
            opacity: 1;
        }
        
        .comparison-active .comparison-year {
            opacity: 0.5;
        }
    </style>
</head>
<body class="text-stone-700 flex flex-col min-h-screen">
    
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Ga naar inhoud</a>
    
    <!-- Toast notification -->
    <div id="toast" class="toast">Link gekopieerd!</div>
    
    <!-- PWA Install Prompt -->
    <div id="install-prompt" class="install-prompt">
        <span>üì±</span>
        <span>Installeer de app!</span>
        <button onclick="installPWA()" class="bg-coral text-white px-4 py-2 rounded-full font-bold text-sm hover:bg-pink-400 transition">
            Installeren
        </button>
        <button onclick="dismissInstall()" class="text-stone-400 hover:text-stone-600">‚úï</button>
    </div>

    <!-- Navbar -->
    <nav class="sticky top-4 z-50 mx-4 md:mx-auto max-w-4xl" aria-label="Hoofdnavigatie">
        <div class="bg-white/80 backdrop-blur-md rounded-full px-4 md:px-6 py-3 shadow-sm border border-white/50 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-yellow-400 w-8 h-8 rounded-full flex items-center justify-center text-white text-sm" aria-hidden="true">‚òÄÔ∏è</div>
                <a href="/" class="font-bold text-lg md:text-xl tracking-tight text-stone-800">Zomer<span class="text-coral">Planner</span></a>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-xs font-semibold text-stone-400 hidden md:block bg-stone-100 px-3 py-1 rounded-full">
                    KNMI '91-'20
                </div>
                <button 
                    id="dark-toggle" 
                    class="dark-toggle" 
                    onclick="toggleDarkMode()"
                    aria-label="Wissel tussen lichte en donkere modus"
                    role="switch"
                    aria-checked="false"
                ></button>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <header class="max-w-3xl mx-auto px-4 py-10 text-center mt-4">
        <h1 class="text-3xl md:text-5xl font-bold mb-6 text-stone-800 leading-tight">
            Vind jouw perfecte <br>
            <span class="text-coral relative inline-block">
                vakantieweek
                <svg class="absolute w-full h-3 -bottom-1 left-0 text-yellow-200 -z-10" viewBox="0 0 100 10" preserveAspectRatio="none" aria-hidden="true"><path d="M0 5 Q 50 10 100 5" stroke="currentColor" stroke-width="8" fill="none" /></svg>
            </span>
        </h1>
        <p class="text-base md:text-lg text-stone-500 max-w-lg mx-auto leading-relaxed">
            Niet iedereen houdt van 30 graden. Verschuif de regelaars en ontdek wanneer de Nederlandse zomer bij <strong>jou</strong> past.
        </p>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="max-w-5xl mx-auto px-4 space-y-8 flex-grow">

        <!-- Calculator Card -->
        <section class="soft-card p-5 md:p-10 relative overflow-hidden" aria-labelledby="calculator-heading">
            <h2 id="calculator-heading" class="sr-only">Vakantie voorkeuren instellen</h2>
            
            <!-- Decorative blobs -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-yellow-100g-yellow-900/20 rounded-full blur-3xl opacity-60 pointer-events-none" aria-hidden="true"></div>
            <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-pink-100g-pink-900/20 rounded-full blur-3xl opacity-60 pointer-events-none" aria-hidden="true"></div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 relative z-10">
                
                <!-- Inputs -->
                <div class="flex flex-col justify-center space-y-6 md:space-y-8">
                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <label for="input-temp" class="font-bold text-base md:text-lg text-stone-700">üå°Ô∏è Temperatuur</label>
                            <span id="val-temp" class="text-sm font-bold bg-[#FFE5D9] text-[#D96C6C] px-3 py-1 rounded-full" aria-live="polite">50%</span>
                        </div>
                        <input 
                            type="range" 
                            id="input-temp" 
                            min="0" 
                            max="100" 
                            value="50"
                            aria-describedby="temp-desc"
                        >
                        <p id="temp-desc" class="text-xs font-medium text-stone-400 mt-2 pl-1">Liever fris <span class="float-right">Hittegolf!</span></p>
                    </div>

                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <label for="input-sun" class="font-bold text-base md:text-lg text-stone-700">‚òÄÔ∏è Zonuren</label>
                            <span id="val-sun" class="text-sm font-bold bg-[#FFF4C3] text-[#B89C26] px-3 py-1 rounded-full" aria-live="polite">50%</span>
                        </div>
                        <input 
                            type="range" 
                            id="input-sun" 
                            min="0" 
                            max="100" 
                            value="50"
                            aria-describedby="sun-desc"
                        >
                        <p id="sun-desc" class="text-xs font-medium text-stone-400 mt-2 pl-1">Wolkje mag <span class="float-right">Bakken</span></p>
                    </div>

                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <label for="input-rain" class="font-bold text-base md:text-lg text-stone-700">‚òî Droogte</label>
                            <span id="val-rain" class="text-sm font-bold bg-[#D0F4F7] text-[#4AA3A8] px-3 py-1 rounded-full" aria-live="polite">50%</span>
                        </div>
                        <input 
                            type="range" 
                            id="input-rain" 
                            min="0" 
                            max="100" 
                            value="50"
                            aria-describedby="rain-desc"
                        >
                        <p id="rain-desc" class="text-xs font-medium text-stone-400 mt-2 pl-1">Buitje is ok√© <span class="float-right">Sahara</span></p>
                    </div>
                    
                    <!-- Share Button -->
                    <button 
                        onclick="sharePreferences()" 
                        class="share-btn w-full bg-gradient-to-r from-coral to-pink-400 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-2 hover:from-pink-400 hover:to-coral transition-all"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                        </svg>
                        Deel jouw ideale week
                    </button>
                </div>

                <!-- Results -->
                <div class="bg-stone-50 rounded-3xl p-5 md:p-8 flex flex-col items-center justify-center text-center border border-stone-100" aria-live="polite" aria-atomic="true">
                    <h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest mb-4 md:mb-6">Jouw top 3 weken</h3>
                    
                    <div class="w-full space-y-4">
                        <!-- #1 Winner -->
                        <div id="rank-1-card" class="rank-card bg-white rounded-2xl p-4 shadow-[0_8px_20px_rgb(0,0,0,0.06)] border border-yellow-100 relative cursor-pointer hover:scale-105 transition-transform duration-300" onclick="highlightWeekInChart(this.dataset.week)" data-week="">
                            <div class="absolute -top-3 -right-3 bg-yellow-400 text-white rounded-full p-2 shadow-sm" aria-label="Beste keuze">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                            </div>
                            <span class="text-3xl md:text-4xl font-extrabold text-stone-800 block" id="rank-1-week">Week --</span>
                            <span class="text-coral font-bold block mb-1" id="rank-1-date">...</span>
                            <span class="text-xs text-stone-400 block" id="rank-1-desc">...</span>
                            
                            <!-- Drukte indicator -->
                            <div class="mt-3 pt-3 border-t border-stone-100">
                                <div class="flex justify-between text-xs text-stone-400 mb-1">
                                    <span>Drukte</span>
                                    <span id="rank-1-drukte-label">Gemiddeld</span>
                                </div>
                                <div class="drukte-bar">
                                    <div id="rank-1-drukte-marker" class="drukte-marker text-yellow-500" style="left: 50%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Runners up -->
                        <div class="grid grid-cols-2 gap-3 md:gap-4">
                            <div id="rank-2-card" class="rank-card bg-white/50 p-3 md:p-4 rounded-2xl border border-stone-100 cursor-pointer hover:scale-105 transition-transform" onclick="highlightWeekInChart(this.dataset.week)" data-week="">
                                <span class="text-xs font-bold text-stone-400 block mb-1">#2</span>
                                <span class="text-lg md:text-xl font-bold text-stone-600ext-stone-200 block" id="rank-2-week">Wk --</span>
                                <span class="text-xs text-stone-400" id="rank-2-drukte">--</span>
                            </div>
                            <div id="rank-3-card" class="rank-card bg-white/50 p-3 md:p-4 rounded-2xl border border-stone-100 cursor-pointer hover:scale-105 transition-transform" onclick="highlightWeekInChart(this.dataset.week)" data-week="">
                                <span class="text-xs font-bold text-stone-400 block mb-1">#3</span>
                                <span class="text-lg md:text-xl font-bold text-stone-600ext-stone-200 block" id="rank-3-week">Wk --</span>
                                <span class="text-xs text-stone-400" id="rank-3-drukte">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visualization -->
        <section class="soft-card p-5 md:p-8" aria-labelledby="chart-heading">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                <div>
                    <h2 id="chart-heading" class="text-xl md:text-2xl font-bold text-stone-800">Het grote plaatje</h2>
                    <p class="text-stone-500 text-sm md:text-base">Gemiddeld weer per week (mei - september)</p>
                </div>
                
                <!-- Comparison toggle -->
                <div class="flex items-center gap-3">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="compare-toggle" class="sr-only peer" onchange="toggleComparison()">
                        <div class="relative w-11 h-6 bg-stone-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-coral/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-coral after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                        <span class="text-sm font-medium text-stone-600">Vergelijk 2023</span>
                    </label>
                </div>
            </div>
            
            <div class="chart-container" role="img" aria-label="Grafiek met temperatuur, zonuren en regenrisico per week van de Nederlandse zomer">
                <canvas id="climateChart"></canvas>
            </div>
            
            <!-- Clear, accessible legend -->
            <div class="flex flex-wrap justify-center gap-2 md:gap-4 mt-6" role="list" aria-label="Grafiek legenda">
                <div class="flex items-center gap-2 bg-[#FFE5D9]g-[#FFE5D9]/20 px-3 py-1.5 rounded-full text-[#D96C6C] text-xs md:text-sm font-semibold" role="listitem">
                    <span class="w-4 h-1 bg-coral rounded"></span>
                    <span>Temp ¬∞C</span>
                </div>
                <div class="flex items-center gap-2 bg-[#FFF4C3]g-[#FFF4C3]/20 px-3 py-1.5 rounded-full text-[#B89C26] text-xs md:text-sm font-semibold" role="listitem">
                    <span class="w-4 h-3 bg-[#FFEaa7] rounded"></span>
                    <span>Zon uur/dag</span>
                </div>
                <div class="flex items-center gap-2 bg-[#D0F4F7]g-[#D0F4F7]/20 px-3 py-1.5 rounded-full text-[#4AA3A8] text-xs md:text-sm font-semibold" role="listitem">
                    <span class="w-4 h-0.5 border-t-2 border-dashed border-[#4AA3A8]"></span>
                    <span>Regenrisico</span>
                </div>
            </div>
            
            <!-- Historical extremes callout -->
            <div id="extremes-callout" class="mt-6 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4 border border-yellow-100">
                <h4 class="font-bold text-stone-700 mb-2 flex items-center gap-2">
                    <span>üìä</span> Historische extremen
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                    <div class="extremen-card rounded-xl p-3">
                        <span class="text-stone-400 block text-xs">Warmste week ooit</span>
                        <span class="font-bold text-[#D96C6C]">Week 30, 2019</span>
                        <span class="text-stone-500 text-xs block">Gem. 29.3¬∞C</span>
                    </div>
                    <div class="extremen-card rounded-xl p-3">
                        <span class="text-stone-400 block text-xs">Zonnigste zomer</span>
                        <span class="font-bold text-[#B89C26]">2022</span>
                        <span class="text-stone-500 text-xs block">+25% zonuren</span>
                    </div>
                    <div class="extremen-card rounded-xl p-3">
                        <span class="text-stone-400 block text-xs">Natste augustus</span>
                        <span class="font-bold text-[#4AA3A8]">2006</span>
                        <span class="text-stone-500 text-xs block">224mm regen</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Schoolvakanties Section -->
        <section class="soft-card p-5 md:p-8" aria-labelledby="vakanties-heading">
            <h2 id="vakanties-heading" class="text-xl md:text-2xl font-bold text-stone-800 mb-2">Schoolvakanties 2026</h2>
            <p class="text-stone-500 mb-6 text-sm md:text-base">Rode weken = druk & duurder. Overweeg de randen!</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="vakantie-card rounded-2xl p-4 border" style="background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.2);">
                    <h3 class="font-bold mb-2" style="color: #3b82f6;">üèîÔ∏è Regio Noord</h3>
                    <p class="text-sm text-stone-600">Groningen, Friesland, Drenthe, Overijssel, Flevoland, Noord-Holland</p>
                    <div class="mt-3 space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-stone-500">Zomervakantie:</span>
                            <span class="font-semibold" style="color: #3b82f6;">18 jul - 30 aug</span>
                        </div>
                        <div class="text-xs text-stone-400">Week 30 t/m 35</div>
                    </div>
                </div>
                
                <div class="vakantie-card rounded-2xl p-4 border" style="background: rgba(34,197,94,0.1); border-color: rgba(34,197,94,0.2);">
                    <h3 class="font-bold mb-2" style="color: #22c55e;">üå≥ Regio Midden</h3>
                    <p class="text-sm text-stone-600">Utrecht, Zuid-Holland, Zeeland</p>
                    <div class="mt-3 space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-stone-500">Zomervakantie:</span>
                            <span class="font-semibold" style="color: #22c55e;">11 jul - 23 aug</span>
                        </div>
                        <div class="text-xs text-stone-400">Week 29 t/m 34</div>
                    </div>
                </div>
                
                <div class="vakantie-card rounded-2xl p-4 border" style="background: rgba(249,115,22,0.1); border-color: rgba(249,115,22,0.2);">
                    <h3 class="font-bold mb-2" style="color: #f97316;">üèñÔ∏è Regio Zuid</h3>
                    <p class="text-sm text-stone-600">Noord-Brabant, Limburg, Gelderland</p>
                    <div class="mt-3 space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-stone-500">Zomervakantie:</span>
                            <span class="font-semibold" style="color: #f97316;">4 jul - 16 aug</span>
                        </div>
                        <div class="text-xs text-stone-400">Week 28 t/m 33</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 rounded-2xl p-4 border" style="background: rgba(255,139,167,0.1); border-color: rgba(255,139,167,0.2);">
                <p class="text-sm text-stone-600">
                    <strong class="text-coral">üí° Tip:</strong> Week 24-27 (juni) en week 36 (begin september) vallen buiten alle schoolvakanties. Vaak beter weer dan verwacht √©n veel rustiger!
                </p>
            </div>
        </section>

        <!-- Regions -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6" aria-labelledby="region-heading">
            <div class="md:col-span-3 text-center">
                <h2 id="region-heading" class="text-xl md:text-2xl font-bold text-stone-800">Kies je regio</h2>
            </div>
            
            <button 
                onclick="setRegion('coast')" 
                id="btn-coast" 
                class="region-btn group bg-whiteg-slate-800 hover:bg-[#D0F4F7]over:bg-teal-900/30 p-5 md:p-6 rounded-[2rem] shadow-sm border border-transparent hover:border-[#4AA3A8] transition-all duration-300 text-left"
                aria-pressed="false"
            >
                <div class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform" aria-hidden="true">üèñÔ∏è</div>
                <h3 class="font-bold text-lg md:text-xl text-stone-800 mb-2">Kust</h3>
                <p class="text-sm text-stone-500 leading-relaxed">
                    Vaker zon in het voorjaar, koeler in de zomer. Minder heftige onweersbuien.
                </p>
            </button>

            <button 
                onclick="setRegion('inland')" 
                id="btn-inland" 
                class="region-btn group bg-whiteg-slate-800 hover:bg-[#FFE5D9]over:bg-red-900/20 p-5 md:p-6 rounded-[2rem] shadow-sm border border-transparent hover:border-[#D96C6C] transition-all duration-300 text-left"
                aria-pressed="false"
            >
                <div class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform" aria-hidden="true">üå≥</div>
                <h3 class="font-bold text-lg md:text-xl text-stone-800 mb-2">Binnenland</h3>
                <p class="text-sm text-stone-500 leading-relaxed">
                    Snel warmer (hittegolven!), maar ook grotere kans op stapelwolken en buien.
                </p>
            </button>
            
            <div class="soft-card p-5 md:p-6 flex flex-col justify-center" aria-live="polite">
                <div class="text-sm font-medium text-stone-400 mb-2 uppercase tracking-wide">Geselecteerde info</div>
                <div id="region-info" class="text-stone-600 font-medium leading-relaxed text-sm md:text-base">
                    Klik op een regio hiernaast voor specifiek advies!
                </div>
            </div>
        </section>
        
        <!-- FAQ Section -->
        <section class="soft-card p-5 md:p-8" aria-labelledby="faq-heading">
            <h2 id="faq-heading" class="text-xl md:text-2xl font-bold text-stone-800 mb-6">Veelgestelde vragen</h2>
            
            <div class="space-y-4">
                <details class="group bg-stone-50 rounded-2xl">
                    <summary class="cursor-pointer p-4 font-semibold text-stone-700 flex justify-between items-center">
                        Wanneer is de beste week voor vakantie in Nederland?
                        <span class="text-coral group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <div class="px-4 pb-4 text-stone-600 text-sm">
                        Statistisch gezien zijn week 30 en 31 (eind juli/begin augustus) gemiddeld het warmst en zonnigst. Maar dit hangt af van je voorkeuren - sommige mensen geven de voorkeur aan het koelere weer in juni of september.
                    </div>
                </details>
                
                <details class="group bg-stone-50 rounded-2xl">
                    <summary class="cursor-pointer p-4 font-semibold text-stone-700 flex justify-between items-center">
                        Hoe betrouwbaar zijn de weervoorspellingen?
                        <span class="text-coral group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <div class="px-4 pb-4 text-stone-600 text-sm">
                        ZomerPlanner gebruikt gemiddelden van KNMI data over 30 jaar (1991-2020). Dit geeft een indicatie van de 'kans' op goed weer, maar het Nederlandse weer blijft onvoorspelbaar. Resultaten bieden geen garantie.
                    </div>
                </details>
                
                <details class="group bg-stone-50 rounded-2xl">
                    <summary class="cursor-pointer p-4 font-semibold text-stone-700 flex justify-between items-center">
                        Is het rustiger buiten de schoolvakanties?
                        <span class="text-coral group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <div class="px-4 pb-4 text-stone-600 text-sm">
                        Ja, buiten de schoolvakanties (vooral buiten de bouwvak in week 31-33) zijn toeristische bestemmingen rustiger en vaak goedkoper. Week 24-26 (juni) biedt vaak een goede balans tussen weer en drukte.
                    </div>
                </details>
                
                <details class="group bg-stone-50 rounded-2xl">
                    <summary class="cursor-pointer p-4 font-semibold text-stone-700 flex justify-between items-center">
                        Wat is het verschil tussen kust en binnenland?
                        <span class="text-coral group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <div class="px-4 pb-4 text-stone-600 text-sm">
                        De kust is gemiddeld 3-5 graden koeler in de zomer door de zeewind, ideaal tijdens hittegolven. Het binnenland wordt warmer maar heeft ook meer kans op onweersbuien.
                    </div>
                </details>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-10 md:py-12 border-t border-stone-100">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 mb-10">
                
                <!-- Col 1: Sources -->
                <div>
                    <h4 class="font-bold text-stone-800 mb-4 text-lg">Bronnen & data</h4>
                    <ul class="space-y-3 text-sm text-stone-500">
                        <li>
                            <a href="https://www.knmi.nl/nederland-nu/klimatologie/normaal-en-extreem" target="_blank" rel="noopener noreferrer" class="hover:text-coral transition-colors flex items-center gap-2 group">
                                <span class="bg-[#FFE5D9] p-1.5 rounded-full text-xs group-hover:scale-110 transition-transform" aria-hidden="true">üìä</span>
                                <span>KNMI Klimaatdashboard (Normaalwaarden 1991-2020)</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.weerstatistieken.nl/" target="_blank" rel="noopener noreferrer" class="hover:text-coral transition-colors flex items-center gap-2 group">
                                <span class="bg-[#FFF4C3] p-1.5 rounded-full text-xs group-hover:scale-110 transition-transform" aria-hidden="true">üìÖ</span>
                                <span>Weerstatistieken.nl (Historische daggegevens)</span>
                            </a>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="bg-[#D0F4F7] p-1.5 rounded-full text-xs" aria-hidden="true">üèñÔ∏è</span>
                            <span>Drukte-indicatoren o.b.v. Schoolvakanties & ANWB trends</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Col 2: About -->
                <div>
                    <h4 class="font-bold text-stone-800 mb-4 text-lg">Over deze tool</h4>
                    <div class="bg-stone-50 rounded-2xl p-5 md:p-6 text-sm text-stone-500 leading-relaxed border border-stone-100">
                        <p class="mb-2">Deze applicatie is gebouwd om inzicht te geven in de 'kansen' op goed weer.</p>
                        <p class="mb-2">Het weer in Nederland is grillig; resultaten bieden geen garantie voor de toekomst.</p>
                        <p>De berekening gebruikt een gewogen gemiddelde van temperatuurmaxima, zonuren en neerslagkans per week.</p>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Copyright -->
            <div class="border-t border-stone-100 pt-8 text-center text-xs font-medium text-stone-400">
                &copy; <span id="copyright-year"></span> ZomerPlanner NL ‚Ä¢ <span class="text-coral">Geniet van de zon, als 'ie schijnt!</span>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA & STATE ---
        const weekData = [
            { week: 22, label: "Eind mei", temp: 18.5, sun: 7.2, dry: 7.0, desc: "Fris & fruitig", drukte: 20 },
            { week: 23, label: "Begin jun", temp: 19.2, sun: 7.4, dry: 6.5, desc: "Lente vibes", drukte: 25 },
            { week: 24, label: "Half jun", temp: 20.0, sun: 7.6, dry: 7.0, desc: "Lange avonden", drukte: 30 },
            { week: 25, label: "Eind jun", temp: 20.8, sun: 7.7, dry: 7.2, desc: "Licht & luchtig", drukte: 35 },
            { week: 26, label: "Eind jun", temp: 21.5, sun: 7.6, dry: 7.0, desc: "Zomer start!", drukte: 40 },
            { week: 27, label: "Begin jul", temp: 22.2, sun: 7.4, dry: 6.8, desc: "Lekker warm", drukte: 55 },
            { week: 28, label: "Half jul", temp: 23.0, sun: 7.3, dry: 6.5, desc: "Terrasweer", drukte: 70 },
            { week: 29, label: "Eind jul", temp: 23.5, sun: 7.2, dry: 6.2, desc: "Top zomer", drukte: 85 },
            { week: 30, label: "Eind jul", temp: 24.0, sun: 7.1, dry: 6.0, desc: "De piek", drukte: 95 },
            { week: 31, label: "Begin aug", temp: 24.0, sun: 7.0, dry: 6.0, desc: "Hondsdagen", drukte: 100 },
            { week: 32, label: "Half aug", temp: 23.8, sun: 6.8, dry: 6.2, desc: "Zwoele avonden", drukte: 90 },
            { week: 33, label: "Half aug", temp: 23.0, sun: 6.5, dry: 6.5, desc: "Nazomeren", drukte: 75 },
            { week: 34, label: "Eind aug", temp: 22.0, sun: 6.0, dry: 6.8, desc: "Rust keert terug", drukte: 50 },
            { week: 35, label: "Begin sep", temp: 20.5, sun: 5.5, dry: 7.0, desc: "Fris water", drukte: 30 },
            { week: 36, label: "Half sep", temp: 19.0, sun: 5.0, dry: 6.5, desc: "Trui aan", drukte: 20 },
        ];
        
        // 2023 comparison data (example - slightly different)
        const weekData2023 = [
            { week: 22, temp: 17.8, sun: 6.5, dry: 6.0 },
            { week: 23, temp: 20.1, sun: 8.2, dry: 7.5 },
            { week: 24, temp: 21.5, sun: 8.0, dry: 7.8 },
            { week: 25, temp: 19.5, sun: 6.2, dry: 5.5 },
            { week: 26, temp: 22.0, sun: 7.8, dry: 7.0 },
            { week: 27, temp: 24.5, sun: 8.5, dry: 8.0 },
            { week: 28, temp: 21.0, sun: 5.5, dry: 4.5 },
            { week: 29, temp: 22.5, sun: 6.8, dry: 5.8 },
            { week: 30, temp: 25.5, sun: 8.2, dry: 7.5 },
            { week: 31, temp: 23.0, sun: 6.5, dry: 5.5 },
            { week: 32, temp: 24.5, sun: 7.2, dry: 6.8 },
            { week: 33, temp: 22.5, sun: 6.0, dry: 6.0 },
            { week: 34, temp: 21.0, sun: 5.5, dry: 6.5 },
            { week: 35, temp: 19.5, sun: 5.0, dry: 7.0 },
            { week: 36, temp: 18.0, sun: 4.5, dry: 6.0 },
        ];
        
        // Schoolvakantie weken (2025)
        const schoolVakanties = {
            noord: { start: 30, end: 35, color: 'rgba(59, 130, 246, 0.1)' },
            midden: { start: 29, end: 34, color: 'rgba(34, 197, 94, 0.1)' },
            zuid: { start: 28, end: 33, color: 'rgba(249, 115, 22, 0.1)' }
        };

        let preferences = { temp: 50, sun: 50, rain: 50 };
        let myChart = null;
        let comparisonMode = false;
        let deferredPrompt = null;
        let highlightedWeek = null;

        const sliderTemp = document.getElementById('input-temp');
        const sliderSun = document.getElementById('input-sun');
        const sliderRain = document.getElementById('input-rain');
        
        const valTemp = document.getElementById('val-temp');
        const valSun = document.getElementById('val-sun');
        const valRain = document.getElementById('val-rain');

        // Set dynamic copyright year
        document.getElementById('copyright-year').textContent = new Date().getFullYear();
        
        // --- URL PARAMETERS ---
        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('temp')) {
                preferences.temp = parseInt(params.get('temp')) || 50;
                sliderTemp.value = preferences.temp;
            }
            if (params.has('sun')) {
                preferences.sun = parseInt(params.get('sun')) || 50;
                sliderSun.value = preferences.sun;
            }
            if (params.has('rain')) {
                preferences.rain = parseInt(params.get('rain')) || 50;
                sliderRain.value = preferences.rain;
            }
            handleInput();
        }
        
        function sharePreferences() {
            const url = new URL(window.location.href.split('?')[0]);
            url.searchParams.set('temp', preferences.temp);
            url.searchParams.set('sun', preferences.sun);
            url.searchParams.set('rain', preferences.rain);
            
            if (navigator.share) {
                navigator.share({
                    title: 'Mijn ideale vakantieweek - ZomerPlanner',
                    text: 'Bekijk mijn ideale vakantieweek volgens de ZomerPlanner!',
                    url: url.toString()
                });
            } else {
                navigator.clipboard.writeText(url.toString()).then(() => {
                    showToast('Link gekopieerd!');
                });
            }
            
            // Update URL without reload
            window.history.replaceState({}, '', url.toString());
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // --- LOCAL STORAGE ---
        function saveToLocalStorage() {
            localStorage.setItem('zomerplanner-prefs', JSON.stringify(preferences));
        }
        
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('zomerplanner-prefs');
            if (saved) {
                const prefs = JSON.parse(saved);
                preferences = { ...preferences, ...prefs };
                sliderTemp.value = preferences.temp;
                sliderSun.value = preferences.sun;
                sliderRain.value = preferences.rain;
            }
        }
        
        // --- DARK MODE ---
        function toggleDarkMode() {
            const toggle = document.getElementById('dark-toggle');
            const isDark = document.body.classList.toggle('dark-mode');
            toggle.classList.toggle('active', isDark);
            toggle.setAttribute('aria-checked', isDark);
            localStorage.setItem('zomerplanner-dark', isDark);
            
            // Update theme color
            document.getElementById('theme-color-meta').content = isDark ? '#1a1a2e' : '#FF8BA7';
            
            // Recreate chart with new colors
            if (myChart) {
                myChart.destroy();
                initChart();
            }
        }
        
        function loadDarkMode() {
            const saved = localStorage.getItem('zomerplanner-dark');
            if (saved === 'true' || (saved === null && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-mode');
                document.getElementById('dark-toggle').classList.add('active');
                document.getElementById('dark-toggle').setAttribute('aria-checked', 'true');
                document.getElementById('theme-color-meta').content = '#1a1a2e';
            }
        }
        
        // --- PWA ---
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                document.getElementById('install-prompt').classList.add('show');
            }, 5000);
        });
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choice) => {
                    if (choice.outcome === 'accepted') {
                        showToast('App ge√Ønstalleerd! üéâ');
                    }
                    deferredPrompt = null;
                    document.getElementById('install-prompt').classList.remove('show');
                });
            }
        }
        
        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('show');
            localStorage.setItem('zomerplanner-install-dismissed', 'true');
        }
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed'));
        }
        
        // --- DRUKTE FUNCTIONS ---
        function getDrukteLabel(drukte) {
            if (drukte < 30) return 'Rustig';
            if (drukte < 50) return 'Gemiddeld';
            if (drukte < 75) return 'Druk';
            return 'Piek';
        }
        
        function getDrukteColor(drukte) {
            if (drukte < 30) return 'text-green-500';
            if (drukte < 50) return 'text-yellow-500';
            if (drukte < 75) return 'text-orange-500';
            return 'text-red-500';
        }

        function calculateScores() {
            const wT = preferences.temp / 100;
            const wS = preferences.sun / 100;
            const wR = preferences.rain / 100;

            const scoredWeeks = weekData.map(d => {
                const nTemp = (d.temp - 18) / (24 - 18);
                const nSun = (d.sun - 5) / (8 - 5);
                const nDry = (d.dry - 5) / (8 - 5);
                let score = (nTemp * wT) + (nSun * wS) + (nDry * wR);
                return { ...d, score: score };
            });

            scoredWeeks.sort((a, b) => b.score - a.score);
            updateUI(scoredWeeks);
        }

        function updateUI(sortedData) {
            const cards = document.querySelectorAll('.rank-card');
            cards.forEach(card => card.classList.add('updating'));
            
            setTimeout(() => {
                const top1 = sortedData[0];
                const top2 = sortedData[1];
                const top3 = sortedData[2];

                // Update #1
                document.getElementById('rank-1-week').textContent = `Week ${top1.week}`;
                document.getElementById('rank-1-date').textContent = top1.label;
                document.getElementById('rank-1-desc').textContent = top1.desc;
                document.getElementById('rank-1-card').dataset.week = top1.week;
                
                // Drukte indicator for #1
                const drukteLabel = getDrukteLabel(top1.drukte);
                const drukteColor = getDrukteColor(top1.drukte);
                document.getElementById('rank-1-drukte-label').textContent = drukteLabel;
                document.getElementById('rank-1-drukte-label').className = drukteColor + ' font-semibold';
                document.getElementById('rank-1-drukte-marker').style.left = top1.drukte + '%';
                document.getElementById('rank-1-drukte-marker').className = `drukte-marker ${drukteColor}`;

                // Update #2 and #3
                document.getElementById('rank-2-week').textContent = `Wk ${top2.week}`;
                document.getElementById('rank-2-card').dataset.week = top2.week;
                document.getElementById('rank-2-drukte').textContent = getDrukteLabel(top2.drukte);
                document.getElementById('rank-2-drukte').className = `text-xs ${getDrukteColor(top2.drukte)}`;
                
                document.getElementById('rank-3-week').textContent = `Wk ${top3.week}`;
                document.getElementById('rank-3-card').dataset.week = top3.week;
                document.getElementById('rank-3-drukte').textContent = getDrukteLabel(top3.drukte);
                document.getElementById('rank-3-drukte').className = `text-xs ${getDrukteColor(top3.drukte)}`;
                
                cards.forEach(card => {
                    card.classList.remove('updating');
                    card.classList.add('updated');
                    setTimeout(() => card.classList.remove('updated'), 500);
                });
            }, 150);
        }
        
        function highlightWeekInChart(week) {
            if (!myChart || !week) return;
            
            const weekIndex = weekData.findIndex(w => w.week == week);
            if (weekIndex === -1) return;
            
            highlightedWeek = week;
            
            // Update chart with highlight
            myChart.options.plugins.annotation.annotations.highlight = {
                type: 'box',
                xMin: weekIndex - 0.5,
                xMax: weekIndex + 0.5,
                backgroundColor: 'rgba(255, 139, 167, 0.2)',
                borderColor: '#FF8BA7',
                borderWidth: 2,
                borderRadius: 8
            };
            
            myChart.update();
            
            // Scroll to chart
            document.getElementById('climateChart').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function toggleComparison() {
            comparisonMode = document.getElementById('compare-toggle').checked;
            if (myChart) {
                myChart.destroy();
                initChart();
            }
        }

        function initChart() {
            const canvas = document.getElementById('climateChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#94a3b8' : '#78716c';
            const gridColor = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.04)';
            
            const labels = weekData.map(d => `Wk ${d.week}`);
            const tempData = weekData.map(d => d.temp);
            const sunData = weekData.map(d => d.sun);
            const rainData = weekData.map(d => 10 - d.dry);

            Chart.defaults.font.family = "'Quicksand', sans-serif";
            Chart.defaults.color = textColor;
            
            // Build datasets
            const datasets = [
                {
                    type: 'line',
                    label: 'Temperatuur (¬∞C)',
                    data: tempData,
                    borderColor: '#FF8BA7',
                    backgroundColor: 'rgba(255, 139, 167, 0.1)',
                    borderWidth: 4,
                    yAxisID: 'y',
                    tension: 0.4,
                    pointRadius: 5,
                    pointBackgroundColor: '#FF8BA7',
                    pointBorderColor: isDark ? '#1e293b' : '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 8,
                    fill: true
                },
                {
                    type: 'bar',
                    label: 'Zonuren per dag',
                    data: sunData,
                    backgroundColor: 'rgba(255, 234, 167, 0.8)',
                    hoverBackgroundColor: '#FFD93D',
                    yAxisID: 'y1',
                    borderRadius: 6,
                    barPercentage: 0.6
                },
                {
                    type: 'line',
                    label: 'Regenrisico',
                    data: rainData,
                    borderColor: '#4AA3A8',
                    borderDash: [6, 4],
                    borderWidth: 3,
                    yAxisID: 'y1',
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    fill: false
                }
            ];
            
            // Add 2023 comparison data if enabled
            if (comparisonMode) {
                datasets.push({
                    type: 'line',
                    label: 'Temp 2023',
                    data: weekData2023.map(d => d.temp),
                    borderColor: 'rgba(255, 139, 167, 0.4)',
                    borderWidth: 2,
                    borderDash: [4, 4],
                    yAxisID: 'y',
                    tension: 0.4,
                    pointRadius: 0,
                    fill: false
                });
            }
            
            // Build school holiday annotations
            const annotations = {};
            
            // All-region overlap (week 30-33) - most crowded
            annotations.bouwvak = {
                type: 'box',
                xMin: labels.indexOf('Wk 30') - 0.5,
                xMax: labels.indexOf('Wk 33') + 0.5,
                backgroundColor: isDark ? 'rgba(239, 68, 68, 0.15)' : 'rgba(239, 68, 68, 0.08)',
                borderColor: 'transparent',
                label: {
                    display: true,
                    content: 'üèñÔ∏è Bouwvak (alle regio\'s)',
                    position: 'start',
                    font: { size: 10, weight: 'bold' },
                    color: isDark ? '#fca5a5' : '#dc2626'
                }
            };

            myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const week = weekData[index].week;
                            highlightWeekInChart(week);
                        }
                    },
                    plugins: {
                        annotation: { annotations },
                        tooltip: {
                            backgroundColor: isDark ? 'rgba(30, 41, 59, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                            titleColor: isDark ? '#f1f5f9' : '#1c1917',
                            bodyColor: isDark ? '#cbd5e1' : '#44403c',
                            borderColor: isDark ? '#334155' : '#e7e5e4',
                            borderWidth: 1,
                            padding: 16,
                            cornerRadius: 12,
                            displayColors: true,
                            boxPadding: 6,
                            titleFont: { weight: 'bold', size: 14 },
                            bodyFont: { size: 13 },
                            callbacks: {
                                title: function(context) {
                                    const weekNum = context[0].label.replace('Wk ', '');
                                    const weekInfo = weekData.find(w => w.week == weekNum);
                                    return `${context[0].label} ‚Äî ${weekInfo ? weekInfo.label : ''}`;
                                },
                                afterTitle: function(context) {
                                    const weekNum = context[0].label.replace('Wk ', '');
                                    const weekInfo = weekData.find(w => w.week == weekNum);
                                    if (weekInfo) {
                                        return `Drukte: ${getDrukteLabel(weekInfo.drukte)}`;
                                    }
                                },
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.datasetIndex === 0) {
                                        label += context.parsed.y.toFixed(1) + '¬∞C';
                                    } else if (context.datasetIndex === 1) {
                                        label += context.parsed.y.toFixed(1) + ' uur/dag';
                                    } else if (context.datasetIndex === 2) {
                                        label += context.parsed.y.toFixed(1) + ' (hoger = natter)';
                                    } else {
                                        label += context.parsed.y.toFixed(1) + '¬∞C';
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true, 
                            position: 'left',
                            min: 15, 
                            max: 28,
                            title: {
                                display: true,
                                text: 'Temperatuur (¬∞C)',
                                color: '#D96C6C',
                                font: { weight: 'bold', size: 11 }
                            },
                            grid: {
                                color: gridColor,
                                borderDash: [4, 4],
                            },
                            ticks: {
                                callback: function(value) { return value + '¬∞'; },
                                stepSize: 2
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            min: 0, 
                            max: 10,
                            title: {
                                display: true,
                                text: 'Zon / Regen',
                                color: '#B89C26',
                                font: { weight: 'bold', size: 11 }
                            },
                            grid: { display: false },
                            ticks: { stepSize: 2 }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { 
                                font: { weight: '600', size: 10 },
                                maxRotation: 0
                            }
                        }
                    }
                }
            });
        }

        function setRegion(region) {
            const info = document.getElementById('region-info');
            const btnCoast = document.getElementById('btn-coast');
            const btnInland = document.getElementById('btn-inland');
            
            btnCoast.setAttribute('aria-pressed', 'false');
            btnInland.setAttribute('aria-pressed', 'false');
            
            if (region === 'coast') {
                btnCoast.setAttribute('aria-pressed', 'true');
                info.innerHTML = "üåä <span class='font-bold text-[#4AA3A8]'>Kust:</span> Perfect voor zonaanbidders in juni. In juli/augustus vaak 3-5 graden koeler dan het binnenland (fijn tijdens hittegolven!), maar let op de zeewind.";
            } else {
                btnInland.setAttribute('aria-pressed', 'true');
                info.innerHTML = "üå≥ <span class='font-bold text-[#D96C6C]'>Binnenland:</span> Hier haal je de hoogste temperaturen. Ideaal voor zwembad-vakanties in de bossen. Wel grotere kans op regenbuien die blijven hangen.";
            }
        }

        function handleInput() {
            preferences.temp = parseInt(sliderTemp.value);
            preferences.sun = parseInt(sliderSun.value);
            preferences.rain = parseInt(sliderRain.value);

            valTemp.textContent = preferences.temp + '%';
            valSun.textContent = preferences.sun + '%';
            valRain.textContent = preferences.rain + '%';

            calculateScores();
            saveToLocalStorage();
        }

        // Debounce for smoother slider experience
        let inputTimeout;
        function debouncedInput() {
            clearTimeout(inputTimeout);
            inputTimeout = setTimeout(handleInput, 50);
        }

        sliderTemp.addEventListener('input', debouncedInput);
        sliderSun.addEventListener('input', debouncedInput);
        sliderRain.addEventListener('input', debouncedInput);

        window.addEventListener('load', () => {
            loadDarkMode();
            loadFromLocalStorage();
            loadFromURL();
            initChart();
            calculateScores();
            
            // Check if install was dismissed
            if (localStorage.getItem('zomerplanner-install-dismissed')) {
                document.getElementById('install-prompt').classList.remove('show');
            }
        });
    </script>
</body>
</html>
